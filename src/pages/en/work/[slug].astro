---
import type { GetStaticPaths } from "astro";
import { getCollection, getEntry } from "astro:content";
import PageLayout from "../../../layouts/PageLayout.astro";
import ContentRender from "@/components/ContentRender/ContentRender.astro";
import { Debug } from "astro:components";

const isDev = import.meta.env.DEV;

export const getStaticPaths = (async () => {
  const pageCollections = await getCollection("work");
  return pageCollections
    .map((p) => {
      const [lang, ...slug] = p.id.split("/");
      return {
        params: {
          slug: slug.join("/"),
        },
        props: {
          id: p.id,
          lang: lang,
          collection: p.collection,
        },
      };
    })
    .filter((v) => v.props.lang === "en");
}) satisfies GetStaticPaths;

const props = Astro.props;
const page = await getEntry("work", props.id);
---

<PageLayout title={`GaoDing | ${page.data.meta.title}`} active="work">
  {
    isDev && (
      <>
        <Debug {props} />
        <Debug {page} />
      </>
    )
  }
  <ContentRender contents={page.data.contents} />
</PageLayout>

---
import type { GetStaticPaths } from "astro";
import { getCollection, getEntry } from "astro:content";
import PageLayout from "../../../layouts/PageLayout.astro";
import ContentRender from "@/components/ContentRender/ContentRender.astro";
import { Debug } from "astro:components";
import type { PathOptions } from "@/components/ContentRender/BlockType";

const isDev = import.meta.env.DEV;

export const getStaticPaths = (async () => {
  const pageCollections = await getCollection("work");
  return pageCollections
    .map((p) => {
      const [lang, ...slug] = p.id.split("/");
      return {
        params: {
          slug: slug.join("/"),
        },
        props: {
          id: p.id,
          lang: lang,
          paths: slug,
          collection: p.collection,
        },
      };
    })
    .filter((v) => v.props.lang === "zh-CN");
}) satisfies GetStaticPaths;

const props = Astro.props;
const page = await getEntry("work", props.id);
const pathInfo: PathOptions = {
  lang: props.lang as Locales,
  paths: props.paths,
  collection: props.collection,
};
---

<PageLayout title={`GaoDing | ${page.data.meta.title}`} active="work">
  {
    isDev && (
      <>
        <Debug {props} />
        <Debug {page} />
      </>
    )
  }
  <ContentRender
    meta={page.data.meta}
    contents={page.data.contents}
    path={pathInfo}
  />
</PageLayout>
